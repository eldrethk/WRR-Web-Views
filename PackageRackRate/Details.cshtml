@model IEnumerable<WRR.Models.PackageRackRateViewModel>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Rack Rates for Packages</h2>
<hr />

<h1 class="mb-3 text-primary">@ViewBag.PackageName</h1>
@Html.ValidationSummary(true, "", new { @class = "text-danger" })
@foreach (var item in Model)
{
    <div class="mb-4">
        <p class="h2 p-2">
            @Html.DisplayFor(modelitem => item.RoomType.Name)
            @if (User.IsInRole("WRRAdmin") || User.IsInRole("Hotel"))
            {
            <button type="button" id="btnAdd" class="anchorAdd btn btn-success" data-id='@item.RoomType.RoomTypeID' data-package-id='@item.Package.PackageID'>Add Rates</button>
            }
        </p>

        @if (item.rates.Count > 0)
        {
            <table class="table table-responsive-sm">
                <tr>
                    <th>
                        @Html.Label("Start Date")
                    </th>
                    <th>
                        @Html.Label("End Date")
                    </th>
                    <th>
                        @Html.Label("Rate")
                    </th>
                    <th></th>
                </tr>
                @foreach (var rack in item.rates)
                {
                    <tr>
                        <td>@Html.DisplayFor(x => rack.StartDate)</td>
                        <td>@Html.DisplayFor(x => rack.EndDate)</td>
                        <td>@Html.DisplayFor(x => rack.Price)</td>
                        <td>
                            @if(User.IsInRole("WRRAdmin") || User.IsInRole("Hotel")) { 
                            @Html.ActionLink("Edit", null, null, new { @class = "btnEdit", data_id = rack.PackageRateID} ) <span> | </span>
                            @Html.ActionLink("Delete", "Delete", new { id = rack.PackageRateID, packageid = item.Package.PackageID, packagename = item.Package.Name, roomname = item.RoomType.Name, start = rack.StartDate, end =rack.EndDate }, new { onclick = "return confirm('Are you sure you want to delete?');"})
                            }
                        </td>
                    </tr>
                }
            </table>
        }
        else
        {
            <div class="alert alert-warning">No Results</div>
        }
    </div>
}
<p>
    <div class="col-auto my-auto">
        @Html.ActionLink("Back to List", "Index")
    </div>
</p>
<div id='addModal' class='modal' role="dialog" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='addModalContent'></div>
        </div>
    </div>

</div>
<div id='editModal' class='modal' role="dialog" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='editModalContent'></div>
        </div>
    </div>

</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">

     
        var AddRatePostBackURL = '/PackageRackRate/AddRate';
        var EditRatePostBackURL = '/PackageRackRate/EditRate';
        $(function () {
            $('.btnEdit').click(function (e) {
                e.preventDefault();
                var $btnClicked = $(this);
                var rackid = $btnClicked.attr('data-id');
               
                $.ajax({
                    type: "GET",
                    url: EditRatePostBackURL,
                    contentType: "application/json; charset=utf-8",
                    data: { "Id": rackid },
                    datatype: "json",
                    success: function (data) {
                        $('#editModalContent').html(data);

                        $('#editModal').modal('show');
                    },
                    error: function () {
                        alert("Content failed to load");
                    }
                });
                
            });
            $('.anchorAdd').click(function (e) {
                e.preventDefault();
                var $buttonClicked = $(this);
                var id = $buttonClicked.attr('data-id');
                var packageid = $buttonClicked.attr('data-package-id');
                $.ajax({
                    type: "GET",
                    url: AddRatePostBackURL,
                    contentType: "application/json; charset=utf-8",
                    data: { "Id": id, "packageid": packageid },
                    datatype: "json",
                    success: function (data) {

                        $('#addModalContent').html(data);

                        $('#addModal').modal('show');

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
            //$("#closebtn").on('click',function(){
            //    $('#myModal').modal('hide');


        });
    </script>
}




